

CREATE TABLE VENDEDOR (
    numvend NUMBER(4),
    nomvend VARCHAR2(30),
    nombrecomer VARCHAR2(30),
    telefono VARCHAR2(11),
    calle VARCHAR2(30),
    ciudad VARCHAR2(20),
    provincia VARCHAR2(20),
    CONSTRAINT pk_vendedor PRIMARY KEY (numvend)
);

CREATE TABLE PIEZA (
    numpieza VARCHAR2(16),
    nompieza VARCHAR2(30),
    preciovent NUMBER(9,2),
    CONSTRAINT pk_pieza PRIMARY KEY (numpieza)
);

CREATE TABLE PRECIOSUM (
    numpieza VARCHAR2(16),
    numvend NUMBER(4),
    preciounit NUMBER(9,2),
    diassum NUMBER(3),
    descuento NUMBER(2),
    CONSTRAINT pk_preciosum PRIMARY KEY (numpieza, numvend),
    CONSTRAINT fk_preciosum_pieza FOREIGN KEY (numpieza) REFERENCES PIEZA(numpieza),
    CONSTRAINT fk_preciosum_vendedor FOREIGN KEY (numvend) REFERENCES VENDEDOR(numvend)
);

CREATE TABLE PEDIDO (
    numpedido NUMBER(5),
    numvend NUMBER(4),
    fecha DATE,
    CONSTRAINT pk_pedido PRIMARY KEY (numpedido),
    CONSTRAINT fk_pedido_vendedor FOREIGN KEY (numvend) REFERENCES VENDEDOR(numvend)
);

CREATE TABLE LINPED (
    numpedido NUMBER(5),
    numlinea NUMBER(2),
    numpieza VARCHAR2(16),
    preciocompra NUMBER(9,2),
    cantpedida NUMBER(4),
    fecharecep DATE,
    cantrecibida NUMBER(4),
    CONSTRAINT pk_linped PRIMARY KEY (numpedido, numlinea),
    CONSTRAINT fk_linped_pedido FOREIGN KEY (numpedido) REFERENCES PEDIDO(numpedido),
    CONSTRAINT fk_linped_pieza FOREIGN KEY (numpieza) REFERENCES PIEZA(numpieza)
);

CREATE TABLE INVENTARIO (
    numpieza VARCHAR2(16),
    numbin NUMBER(10),
    cantdisponible NUMBER(5),
    fecharecuento DATE,
    periodorecuen NUMBER(2),
    cantminima NUMBER(5),
    CONSTRAINT pk_inventario PRIMARY KEY (numbin),
    CONSTRAINT uq_inventario_numpieza UNIQUE (numpieza),
    CONSTRAINT fk_inventario_pieza FOREIGN KEY (numpieza) REFERENCES PIEZA(numpieza)
);

INSERT INTO VENDEDOR VALUES (1001, 'Juan Pérez', 'Comercial Norte', '600123456', 'Calle A', 'Madrid', 'Madrid');
INSERT INTO VENDEDOR VALUES (1002, 'Ana Gómez', 'Distribuciones Sur', '600654321', 'Calle B', 'Sevilla', 'Sevilla');
INSERT INTO VENDEDOR VALUES (1003, 'Carlos Ruiz', 'Tienda Centro', '600112233', 'Calle C', 'Valencia', 'Valencia');
INSERT INTO VENDEDOR VALUES (1004, 'Laura Sánchez', 'Comercial Este', '600998877', 'Calle D', 'Barcelona', 'Barcelona');
INSERT INTO VENDEDOR VALUES (1005, 'Luis Torres', 'Almacenes López', '600334455', 'Calle E', 'Bilbao', 'Vizcaya');
INSERT INTO VENDEDOR VALUES (1006, 'Marta López', 'Tienda Express', '600556677', 'Calle F', 'Zaragoza', 'Zaragoza');
INSERT INTO VENDEDOR VALUES (1007, 'Pedro Martínez', 'Logística Uno', '600223344', 'Calle G', 'Toledo', 'Toledo');
INSERT INTO VENDEDOR VALUES (1008, 'Isabel Romero', 'Red Sur', '600778899', 'Calle H', 'Granada', 'Granada');
INSERT INTO VENDEDOR VALUES (1009, 'Raúl Herrera', 'Suministros Express', '600887766', 'Calle I', 'Córdoba', 'Córdoba');
INSERT INTO VENDEDOR VALUES (1010, 'Sonia Nieto', 'Canal 10', '600334411', 'Calle J', 'Murcia', 'Murcia');

INSERT INTO PIEZA VALUES ('PZ001', 'Tornillo acero', 0.25);
INSERT INTO PIEZA VALUES ('PZ002', 'Tuerca acero', 0.15);
INSERT INTO PIEZA VALUES ('PZ003', 'Arandela inoxidable', 0.10);
INSERT INTO PIEZA VALUES ('PZ004', 'Clavo cabeza redonda', 0.08);
INSERT INTO PIEZA VALUES ('PZ005', 'Pasador metálico', 0.20);
INSERT INTO PIEZA VALUES ('PZ006', 'Eje cilíndrico', 1.00);
INSERT INTO PIEZA VALUES ('PZ007', 'Rodamiento simple', 3.50);
INSERT INTO PIEZA VALUES ('PZ008', 'Resorte', 0.60);
INSERT INTO PIEZA VALUES ('PZ009', 'Engranaje pequeño', 5.25);
INSERT INTO PIEZA VALUES ('PZ010', 'Tornillo largo', 0.35);

INSERT INTO PRECIOSUM VALUES ('PZ001', 1001, 0.20, 3, 5);
INSERT INTO PRECIOSUM VALUES ('PZ002', 1002, 0.13, 2, 0);
INSERT INTO PRECIOSUM VALUES ('PZ003', 1003, 0.09, 5, 3);
INSERT INTO PRECIOSUM VALUES ('PZ004', 1004, 0.07, 4, 2);
INSERT INTO PRECIOSUM VALUES ('PZ005', 1005, 0.18, 6, 1);
INSERT INTO PRECIOSUM VALUES ('PZ006', 1006, 0.95, 7, 4);
INSERT INTO PRECIOSUM VALUES ('PZ007', 1007, 3.20, 5, 0);
INSERT INTO PRECIOSUM VALUES ('PZ008', 1008, 0.55, 2, 2);
INSERT INTO PRECIOSUM VALUES ('PZ009', 1009, 5.00, 10, 5);
INSERT INTO PRECIOSUM VALUES ('PZ010', 1010, 0.30, 3, 1);

INSERT INTO PEDIDO VALUES (20001, 1001, TO_DATE('2024-09-01', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20002, 1002, TO_DATE('2024-09-02', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20003, 1003, TO_DATE('2024-09-03', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20004, 1004, TO_DATE('2024-10-04', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20005, 1005, TO_DATE('2024-10-05', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20006, 1006, TO_DATE('2025-02-06', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20007, 1007, TO_DATE('2025-02-07', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20008, 1008, TO_DATE('2025-03-08', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20009, 1009, TO_DATE('2025-05-09', 'YYYY-MM-DD'));
INSERT INTO PEDIDO VALUES (20010, 1010, TO_DATE('2025-05-10', 'YYYY-MM-DD'));

INSERT INTO LINPED VALUES (20001, 1, 'PZ001', 0.20, 100, TO_DATE('2024-05-03', 'YYYY-MM-DD'), 100);
INSERT INTO LINPED VALUES (20002, 1, 'PZ002', 0.13, 200, TO_DATE('2024-05-05', 'YYYY-MM-DD'), 200);
INSERT INTO LINPED VALUES (20003, 1, 'PZ003', 0.09, 150, TO_DATE('2024-05-06', 'YYYY-MM-DD'), 150);
INSERT INTO LINPED VALUES (20004, 1, 'PZ004', 0.07, 250, TO_DATE('2024-05-07', 'YYYY-MM-DD'), 250);
INSERT INTO LINPED VALUES (20005, 1, 'PZ005', 0.18, 80, TO_DATE('2024-05-08', 'YYYY-MM-DD'), 80);
INSERT INTO LINPED VALUES (20006, 1, 'PZ006', 0.95, 30, TO_DATE('2024-05-09', 'YYYY-MM-DD'), 30);
INSERT INTO LINPED VALUES (20007, 1, 'PZ007', 3.20, 20, TO_DATE('2024-05-10', 'YYYY-MM-DD'), 20);
INSERT INTO LINPED VALUES (20008, 1, 'PZ008', 0.55, 100, TO_DATE('2024-05-11', 'YYYY-MM-DD'), 100);
INSERT INTO LINPED VALUES (20009, 1, 'PZ009', 5.00, 10, TO_DATE('2024-05-12', 'YYYY-MM-DD'), 10);
INSERT INTO LINPED VALUES (20010, 1, 'PZ010', 0.30, 120, TO_DATE('2024-05-13', 'YYYY-MM-DD'), 120);

INSERT INTO INVENTARIO VALUES ('PZ001', 5001, 500, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 100);
INSERT INTO INVENTARIO VALUES ('PZ002', 5002, 300, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 80);
INSERT INTO INVENTARIO VALUES ('PZ003', 5003, 200, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 60);
INSERT INTO INVENTARIO VALUES ('PZ004', 5004, 400, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 90);
INSERT INTO INVENTARIO VALUES ('PZ005', 5005, 150, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 50);
INSERT INTO INVENTARIO VALUES ('PZ006', 5006, 75, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 25);
INSERT INTO INVENTARIO VALUES ('PZ007', 5007, 60, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 20);
INSERT INTO INVENTARIO VALUES ('PZ008', 5008, 90, TO_DATE('2024-06-01', 'YYYY-MM-DD'), 1, 30);

-- NOMBRE: Victor Aracil

-- Ejercicio 1 (función en PL/SQL)
CREATE FUNCTION calcula_total(fechainc DATE, fechafin DATE)
          RETURN pedido
          IS
          BEGIN
             SELECT
          END calcula_total;
      


-- Ejercicio 2 (procedimiento PL/SQL)


